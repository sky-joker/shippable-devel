language: python

runtime:
  nodePool: shippable_shared_aarch64
  container: true

build:
  ci:
    #- ls /home/shippable/cache
    #- docker pull centos:7
    #- docker run -d -it -v /home/shippable/cache:/opt --name test centos:7
    #- docker run --privileged -v /opt:/opt --name some-docker -d docker:dind
    - docker run --privileged -v /opt:/opt --name some-docker -d centos:7 /bin/sh
    - echo $?
    - docker ps
    - docker ps -a
    - for i in $( docker ps -a --format '{{ .ID }}' ) ; do docker exec $i ls ; done
    #- for i in $( docker ps -a --format '{{ .ID }}' ) ; do docker exec $i sh -c 'docker pull centos:7' ; done
    #- for i in $( docker ps -a --format '{{ .ID }}' ) ; do docker exec $i sh -c 'docker run -d -v /opt:/opt --name test centos:7 ; echo $?' ; done
    #- for i in $( docker ps -a --format '{{ .ID }}' ) ; do docker exec $i sh -c 'docker ps' ; done
    #- for i in $( docker ps -a --format '{{ .ID }}' ) ; do docker exec $i sh -c 'docker ps -a' ; done
#  pre_ci_boot:
#    options: "-v /tmp:/tmp"
  #ci:
    #- apt install -y docker gcc python-dev
    #- pip install ansible docker-compose sdist
    #- apt install -y python-dev ansible gcc
    #- pip install docker-compose
    #- git clone https://github.com/sky-joker/awx-arm64arch.git
    #- cp -r awx-arm64arch/ /home/shippable/cache
    #- cd /home/shippable/cache/awx-arm64arch/
    #- git checkout -b 4.0.0 refs/tags/4.0.0
    #- cd installer/
    #- sed -i "s/..\/:\/awx:Z/\/root\/src\/github.com\/sky-joker\/shippable-devel\/awx-arm64arch:\/awx:Z/g" roles/image_build/tasks/main.yml
    #- ansible-playbook build.yml -i inventory
  #on_failure:
  #  - docker rm awx_sdist_builder
  #  - docker run -v /root/src/github.com/sky-joker/shippable-devel/awx-arm64arch:/awx --name awx_sdist_builder awx_sdist_builder:4.0.0
  #  - pwd
  #  - ls
  #  - ls ../
  #  - ls ../dist
  #  - docker ps -a
  #  - docker images
  #  - cat roles/image_build/tasks/main.yml
