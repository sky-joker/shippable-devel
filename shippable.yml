language: python

runtime:
  nodePool: shippable_shared_aarch64
  container: true

build:
#  pre_ci_boot:
#    options: "-v /tmp:/tmp"
  ci:
    #- apt install -y docker gcc python-dev
    #- pip install ansible docker-compose sdist
    - apt install -y python-dev ansible
    - pip install docker-compose
    - git clone https://github.com/sky-joker/awx-arm64arch.git
    - cd awx-arm64arch/
    - git checkout -b 4.0.0 refs/tags/4.0.0
    - cd installer/
    - ansible-playbook build.yml -i inventory -vvv
  on_failure:
    - pwd
    - ls
    - ls ../
    - docker ps -a
    - docker images
